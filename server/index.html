<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>homePage</title>
    <style>
        body{
            --fo:#321321
        }
        div{
            color:var(--fo)
        }
    </style>
</head>
<body>
<h2>
    post 请求用例
</h2>
<select name="fields" id="fields">
    <option value="articles">文章测试</option>
    <option value="articlesId">文章测试id</option>
    <option value="tags">tag测试</option>
</select>
<span>title</span><input type="text" id="title">
<span>excerpt</span><input type="text" id="excerpt">
<span>content</span><input type="text" id="content">
<span>id</span><input type="text" id="id">
<input type="button" id="submit" value="提交">
<input type="button" id="query" value="查询">
<script>
    window.onload = ()=>{
        const btn = document.querySelectorAll('#submit')[0]
        const query = document.querySelectorAll('#query')[0]
        const titleField = document.querySelectorAll('#title')[0]
        const excerptField = document.querySelectorAll('#excerpt')[0]
        const contentField = document.querySelectorAll('#content')[0]
        const selectField = document.querySelectorAll('#fields')[0]
        const idField = document.querySelectorAll('#id')[0]
        /*btn.onclick = async() => {
            console.log(title,content)
            const result = await post('./test',{
                title:'你好',
                content:'这是一个内容'
            })
            console.log(result)
        }*/
        btn.onclick = async () =>{
            const title = titleField.value
            const content = contentField.value
            const excerpt = excerptField.value
            const field = selectField.value
            try {
                const result = await post(`./${field}`, {
                    name:title,
                    content:content,
                    excerpt:excerpt
                })
                console.log(result)
            } catch (e) {
                console.log(e)
                throw e
            }
        }
        query.onclick = async ()=> {
            const field = selectField.value
            let result = null
            try {
                switch (field){
                    case "articles":
                        result = await get(`./${field}?tag=1`)
                        break;
                    case "articlesId":
                        const id = idField.value
                        result = await get(`./${"articles"}/${id}`)
                        break;
                    case "tags":
                        result = await get(`./${field}`)
                        break;
                }
                console.log(result)
            } catch (e) {
                console.log(e)
                throw e
            }
        }
        const post = async function(url,data){
            try {
                return await window.fetch(url,{
                    method:'POST',
                    headers:{
                        'Accept':'application/json',
                        'Content-Type':'application/json',
                    },
                    body:JSON.stringify(data)
                }).then(res => res.json())
            } catch (e) {
                console.log(e)
                throw e
            }
        }
        const get = async (url) => {
            try{
                return await window.fetch(url).then(response => response.json())
            } catch (e){
                console.log(e)
                throw e
            }
        }
    }
</script>
</body>
</html>